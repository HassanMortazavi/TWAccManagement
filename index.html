<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ویرایش فایل دراپ‌باکس</title>
</head>
<body>
  <h2>اضافه کردن "سلام" به انتهای فایل دراپ‌باکس</h2>
  <button onclick="appendToFile()">اضافه کن</button>
  
  <script>
    const accessToken = "YOUR_ACCESS_TOKEN";  // توکن دراپ‌باکس
    const filePath = "/test.txt";  // مسیر فایل در Dropbox

    async function appendToFile() {
      let currentContent = "";
      
      // ۱. تلاش برای خواندن محتوای فعلی فایل
      try {
        const getFileUrl = "https://content.dropboxapi.com/2/files/download";
        const getFileResponse = await fetch(getFileUrl, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${accessToken}`,
            "Dropbox-API-Arg": JSON.stringify({ "path": filePath })
          }
        });
        
        if (getFileResponse.ok) {
          currentContent = await getFileResponse.text();
        } else {
          const errorText = await getFileResponse.text();
          // اگر فایل وجود نداشته باشد، Dropbox معمولا خطای "path/not_found" می‌دهد
          if (errorText.indexOf("path/not_found") !== -1) {
            currentContent = "";
          } else {
            throw new Error("خطا در خواندن فایل: " + errorText);
          }
        }
      } catch (error) {
        alert("❌ خطا در خواندن فایل: " + error.message);
        return;
      }
      
      // ۲. اضافه کردن متن "سلام" به انتهای محتوا
      const newContent = currentContent + "\nسلام";
      // تبدیل رشته به باینری
      const encodedContent = new TextEncoder().encode(newContent);
      
      // ۳. آپلود (یا ایجاد) فایل با محتوای جدید
      try {
        const uploadUrl = "https://content.dropboxapi.com/2/files/upload";
        const uploadResponse = await fetch(uploadUrl, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${accessToken}`,
            "Dropbox-API-Arg": JSON.stringify({
              "path": filePath,
              "mode": "overwrite"
            }),
            "Content-Type": "application/octet-stream"
          },
          body: encodedContent
        });
        
        if (!uploadResponse.ok) {
          throw new Error("خطا در ذخیره فایل: " + await uploadResponse.text());
        }
        alert("✅ متن 'سلام' به فایل اضافه شد!");
      } catch (error) {
        alert("❌ خطا در ذخیره فایل: " + error.message);
      }
    }
  </script>
</body>
</html>
